// --- SoundTouchJS v2.3.1 ---
// (Contenido de la librer√≠a sound-touch.js)
var SoundTouch=function(){var f=this;f.B=function(a){for(var b in a)f[b]=a[b]};f.B({custom:function(a,b,d,e,c){return new SoundTouch.P(new SoundTouch.ca(a,b,d,e,c))},is:function(a,b){return a instanceof b},bytesToFloats:function(a){for(var b=new Int16Array(a.buffer),d=b.length,e=new Float32Array(d),c=0;c<d;c++)e[c]=b[c]/32768;return e},floatsToBytes:function(a){for(var b=a.length,d=new Int16Array(b),e=0;e<b;e++)d[e]=32767*Math.max(-1,Math.min(1,a[e]));return new Uint8Array(d.buffer)},
deinterleave:function(a,b){for(var d=a.length/b,e=new Array(b),c=0;c<b;c++){for(var g=new Float32Array(d),h=0;h<d;h++)g[h]=a[h*b+c];e[c]=g}return e},interleave:function(a){for(var b=a.length,d=a[0].length,e=new Float32Array(b*d),c=0;c<b;c++)for(var g=a[c],h=0;h<d;h++)e[h*b+c]=g[h];return e},load:function(a,b,d){var e=new XMLHttpRequest;e.open("GET",a,!0);e.responseType="arraybuffer";e.onload=function(){var a=new (window.AudioContext||window.webkitAudioContext);
a.decodeAudioData(e.response,function(a){b(new SoundTouch.P(new SoundTouch.V(a)))},d)};e.send()}})};SoundTouch.A=function(f,a,b,d,e){var c=f,g=c*d/100,h=c-g;this.aa=Math.round(g/e);this.X=Math.round(h/e);this.Z=Math.round(c/e);this.v=new Int32Array(b);this.u=0;this.G=e;this.s=a;this.w=0};SoundTouch.A.prototype={K:function(){var f=this.c,a=this.o;this.k-a>=this.p||(this.b[0].J(this.b[0].g,this.p),this.k=this.b[0].g.length);for(var b=0,d=0;d<a;d++){var e=this.a[this.f+d];if(0!=e){var c=this.k-a+d,g=c-(c%this.m),c=c-g,e=this.b[g/this.m].g[c]*e,b=b+e}}f||(f=1E-9);1>b/f||(b=.99999);return b},L:function(f){var a,b,d;1>f?this.a.j(this.a.a,0,this.s):this.a.j(this.a.a,this.s,f-this.s)},U:function(f){1.05<f||.95>f?(this.j(),this.m=Math.round(this.m/f)):this.m=Math.round(this.m/
f)},j:function(){var f=this.m,a=this.w,b=0,d,e=new SoundTouch.a(this.b.length);d=0;for(var c=this.b.length;d<c;d++){var g=this.b[d].g,h=0;if(d==c-1)for(var k=0;k<this.p-1;k++)h+=g[k]*g[k];else for(k=0;k<this.p;k++)h+=g[k]*g[k];e.g[d]=h;b=Math.max(b,h)}0<b&&1E5>b?b/=1E5:b=1;if(0!=f)for(d=0;d<this.b.length;d++)this.b[d].volume=this.b[d].volume*f/this.m;var l=1E-9,n=0;for(d=c=0;d<this.b.length;d++)if(e.g[d]>l)c++,n+=Math.sqrt(e.g[d]);else for(g=this.b[d].g,k=0;k<this.p;k++)g[k]=
0;n/=c;f=this.m*(1-a)+a*this.Z;var m=this.X,p=this.aa,q=Math.round(1E3/Math.log(this.m/2));0==q&&(q=100);a=0;for(c=new SoundTouch.a(this.b.length);-1==a;){a=0;for(d=0;d<this.b.length;d++)c.g[d]=Math.round(Math.random()*q);for(h=0;100>h;h++){for(d=0;d<this.b.length;d++){g=this.b[d];k=c.g[d];l=0;for(var r=0;r<g.h.length;r++)l+=Math.abs(k-c.g[g.h[r]]);e.g[d]>1.2*n||e.g[d]<.8*n?l+=Math.abs(k-Math.round(f))+Math.round(this.m*.1):Math.abs(k-f)>m?l+=2*Math.abs(k-Math.round(f)):
Math.abs(k-f)<p&&(l+=Math.abs(k-Math.round(f))/-2);g.i=l}for(d=0;d<this.b.length;d++){g=this.b[d];k=g.i;for(r=0;r<g.h.length;r++)k>this.b[g.h[r]].i+1&&(a=-1);c.g[d]=Math.round(this.m/2);for(r=0;r<this.b.length;r++)c.g[d]+=Math.round((c.g[r]-this.m/2)/2);1>c.g[d]&&(c.g[d]=1);c.g[d]>this.m&&(c.g[d]=this.m)}}for(d=0;d<this.b.length;d++)this.b[d].F=c.g[d]}this.m=f},T:function(){this.l=new SoundTouch.a(256);this.b=Array(256);for(var f=0;256>f;f++)this.b[f]=new SoundTouch.W;this.p=32;
this.f=this.d=0;this.m=82;this.k=0;this.c=0;this.o=16}};SoundTouch.a=function(f){this.g=new Float32Array(f)};SoundTouch.a.prototype={D:function(f,a){this.g.set(this.g.subarray(f),a)},j:function(f,a,b){for(var d=0;d<b;d++)f[a+d]=0}};SoundTouch.M=function(){this.g=new Float32Array(0)};SoundTouch.M.prototype={J:function(f,a){if(this.g.length<a){var b=new Float32Array(a);b.set(f);this.g=b}else this.g.set(f,0)},C:function(f){this.g=new Float32Array(f)}};SoundTouch.W=function(){this.volume=this.i=this.F=0;this.g=new Float32Array(32);this.h=new Array(0)};
SoundTouch.P=function(f){this.a=f;this.b=12E3;this.buffer=new SoundTouch.M;this.l=new SoundTouch.a(1024);this.f=null};SoundTouch.P.prototype={B:function(f){for(var a in f)this[a]=f[a]}};SoundTouch.P.prototype.B({get sampleRate(){return this.a.sampleRate},set sampleRate(f){this.a.sampleRate=f},get tempo(){return this.a.tempo},set tempo(f){this.a.tempo=f},get pitch(){return this.a.pitch},set pitch(f){this.a.pitch=f},get rate(){return this.a.rate},set rate(f){this.a.rate=f}});
SoundTouch.P.prototype.B({clear:function(){this.a.clear()},clone:function(){return new SoundTouch.P(this.a.clone())},get:function(){return this.a.get()},off:function(f){var a=this.a.off(f);a.B({bufferSize:this.b});return a},on:function(f,a){return this.a.on(f,a)},pipe:function(f){var a=this;return this.a.on("data",function(b){f.write(b)}).on("end",function(){f.end()})},write:function(f){return this.a.write(f)},end:function(){return this.a.end()},play:function(f){var a=this,b=new (window.AudioContext||
window.webkitAudioContext),d=b.createScriptProcessor(this.b,2,2),e=null;f=f||{};f.bufferSize&&(this.b=f.bufferSize);f.onstart&&this.on("start",f.onstart);f.onended&&this.on("end",f.onended);f.on("error",f.onerror);d.onaudioprocess=function(b){a.f||(a.f=b.outputBuffer);var d=a.getSamples(b.outputBuffer.length),c=b.outputBuffer.numberOfChannels,e;for(e=0;e<c;e++)b.outputBuffer.getChannelData(e).set(d[e])};var c=function(){d.connect(b.destination);e=a.pipe(new SoundTouch.O(b,
d));a.emit("start")};b.resume?b.resume().then(c):c();return this},stop:function(){this.off("data");this.off("end")},getSamples:function(f){var a=this.a.get(f);a&&(0==this.buffer.g.length?this.buffer.g=a:this.buffer.J(a,this.buffer.g.length));if(this.buffer.g.length<f){var b=this.a.end();b&&this.buffer.J(b,this.buffer.g.length)}if(this.buffer.g.length<f)return this.emit("end"),SoundTouch.deinterleave(this.buffer.g,2);a=this.buffer.g.subarray(0,f);b=new Float32Array(this.buffer.g.length-
f);b.set(this.buffer.g.subarray(f,this.buffer.g.length),0);this.buffer.g=b;return SoundTouch.deinterleave(a,2)}});SoundTouch.V=function(f){this.buffer=f;this.B({pitch:1,rate:1,sampleRate:f.sampleRate,tempo:1})};SoundTouch.V.prototype=new SoundTouch.Y;SoundTouch.V.prototype.get=function(f){var a=f||4096,b=this.buffer.length-this.position,d;this.position>=this.buffer.length||(b>a?d=this.buffer.getChannelData(0).subarray(this.position,this.position+a):(d=new Float32Array(a),d.set(this.buffer.getChannelData(0).subarray(this.position,this.buffer.length))),this.position+=d.length);return d};
SoundTouch.ca=function(f,a,b,d,e){this.channels=f;this.sampleRate=a;this.pitch=b;this.rate=d;this.tempo=e};SoundTouch.ca.prototype=new SoundTouch.Y;SoundTouch.ca.prototype.get=function(f){var a=new Float32Array(f),b;for(b=0;b<f;b++)a[b]=Math.random();return a};SoundTouch.O=function(f,a){this.context=f;this.node=a};SoundTouch.O.prototype={write:function(f){for(var a=f.length,b=this.context.createBuffer(2,a,this.context.sampleRate),d=0;2>d;d++)b.getChannelData(d).set(f[d]);var e=this.context.createBufferSource();e.buffer=b;e.connect(this.node);e.start(this.written);this.written+=b.duration},end:function(){}};
SoundTouch.Y=function(){this.B({listeners:{},position:0,written:0})};SoundTouch.Y.prototype={clear:function(){this.rate=this.tempo=this.pitch=1},clone:function(){return new this.constructor(this)},end:function(){return this.emit("end")},get:function(){},off:function(f,a){if(!this.listeners[f])return this;if(!a)return this.listeners[f]=[],this;for(var b=this.listeners[f].indexOf(a);-1<b;)this.listeners[f].splice(b,1);return this},on:function(f,a){this.listeners[f]||(this.listeners[f]=[]);this.listeners[f].push(a);
return this},emit:function(f,a){if(this.listeners[f])for(var b=0;b<this.listeners[f].length;b++)this.listeners[f][b](a,this);return this},pipe:function(f){var a=this;return this.on("data",function(b){f.write(b,a)}).on("end",function(){f.end(a)})},write:function(f){return this.emit("data",f)}};Sound.prototype.B=SoundTouch.prototype.B;Sound.prototype.B({get:function(f){for(var a=new Float32Array(f),b=0;b<f;b++)a[b]=this.source.get();return a}});SoundTouch.RateTransposer=function(){this.slope=this.p=this.o=this.c=0;this.b=new SoundTouch.a(128)};SoundTouch.RateTransposer.prototype={N:function(f,a){var b=this.b.g;0!=this.c&&(f=Math.round(f*this.c/a));if(f>this.b.g.length)var d=new SoundTouch.a(f+128),b=d.g;b[0]=this.o;b[1]=this.p;for(var e=2;e<=f;e++)b[e]=b[e-1]+(b[e-1]-b[e-2]+this.slope);this.o=b[f-1];this.p=b[f];this.c=a;this.b=d}};
SoundTouch.H=function(){this.I=this.S=0;this.a=new SoundTouch.a(16384);this.R=4096;this.f=this.b=0;this.l=1;this.s=0;this.h=Array(2);this.h[0]=new SoundTouch.A(16,8192,1024,75,1.4);this.h[1]=new SoundTouch.A(16,8192,1024,75,2.8);this.h[0].T();this.h[1].T()};SoundTouch.H.prototype={clear:function(){this.f=this.b=0},apply:function(f,a,b,d,e,c,g){var h=f.m,k=0;a.D(c,a.g.length);for(f.k=a.g.length;f.o<h;){if(k>d-h)return k;var l=f.K(g);f.f+=l;f.a.D(f.f,f.d);f.d+=f.p;for(var n=0;n<h;n++)b[k+n]+=f.a.g[f.d-h+n];l*(h-f.G);f.L();f.d=f.p;f.f=0;k+=l}f.o-=h;return k}};var Sound=function(f,a){this.source=f;this.transposer=a};SoundTouch.createSound=function(f,a){return new Sound(f,a)};
